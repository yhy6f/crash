0318
imported crashes2005_2014,crashes2015, fatal2005_2014, fatal2015

-to find out no of fatal crashes, ran query crashrptno_killed_05_15:
SELECT crashrptno, killed from fatal2005_2014
UNION 
Select 1,2 from fatal2015
73 records
one record:
crashrptno  killed
1	    2

-to find out which record it is, ran query "crashrptno=1_fatal15" "crashrptno=1_fatal05_14"
no result

-to stitch together all data from 05 to 15, ran query "create_crash_05_15", "create_fatal_05_15":
CREATE TABLE crashl05_15 AS SELECT * FROM crash2015;
INSERT INTO crash05_15 SELECT * FROM crash2005_2014;
CREATE TABLE fatal05_15 AS SELECT * FROM fatal2015;
INSERT INTO fatal05_15 SELECT * FROM fatal2005_2014;

-to make tablenames consistent, removed plurals and "20"s

-redid the fatal crashes, ran query "no_of_fatal_05_15"
78 results
inconsistent with excel table final project, which has numbers of crashes, fatal crashes, and fatalities from MO highway patrol website

to find out which year is  missing, wanted to query each year, found the need to parse the years out of the date field, exported table crash05_15, fatal05_15



0321

"create table type_str_05_15"
 CREATE TABLE type_str_05_15 AS SELECT crashrptno, crashtype, severity, AtStreet, OnStreet, injured, killed FROM crash05_15 GROUP BY crashrptno

"crashtype_w_most_crashes":
SELECT COUNT(crashrptno), crashtype FROM type_str_05_15
GROUP BY 2
ORDER BY 1 DESC

"intersec_w_most_crashes":
SELECT atstreet, onstreet, COUNT(crashrptno) FROM type_str_05_15
GROUP BY 1, 2
ORDER BY 3 DESC

found that crash05_15.csv has a line with no values.
deleted the line of record in crash05_15 in SQLyog.
SELECT * FROM crash05_15
WHERE crashrptno = 0

then found that only the records in 2015 has no spaces, while the rest of the year has.for example, MO743 and MO 743. could influence the onstreet atstreet where most crashes happen. need to re-import.

redownloaded crashes2015. replaced two spaces, three spaces, 5,6 spaces, and space and ', and all '.
saved as crashes.txt

reimported crashes2015 into database crash. deleted crash15 and renamed crashes2015 into crash15. redid the stitch.
CREATE TABLE crashl05_15 AS SELECT * FROM crash15;
INSERT INTO crash05_15 SELECT * FROM crash05_14;

then found that the spaces in fieldnames is messing me up. so replaced spaces with _ in fieldnames by design table function in Navicat for all three tables: crash15, crash 05_14, and crash05_15

revised query "create table type_str_05_15":
 CREATE TABLE type_str_05_15 AS SELECT crash_rpt_no, crash_type, severity, At_Street, On_Street, injured, killed FROM crash05_15 GROUP BY crash_rpt_no

revised query "crashtype_w_most_crashes":
SELECT COUNT(crash_rpt_no), crash_type FROM type_str_05_15
GROUP BY 2
ORDER BY 1 DESC

ran query, result:

revised query "intersec_w_most_crashes":
SELECT atstreet, onstreet, COUNT(crashrptno) FROM type_str_05_15
GROUP BY 1, 2
ORDER BY 3 DESC


fatal05_14(195) and fatal05_15(208) doesn't have spaces between words. just going to leave them there.

LESSONS:
Keep record of how you cleaned the data, and keet consistent
Fieldnames: replace space with _
Importing: .txt better; data type should be consistent
After importing: check intgrity, number of records, 

0322
had Liz look over the data 

add_year_field:
## Run this query to make sure that the YEAR( ) function works correctly on the `Date` field, because date is a function, so use ` as escape
SELECT `Date`, YEAR(`Date`), COUNT(*)
FROM crash05_15
GROUP BY 1, 2;
## this statement adds the field `crash_year` as an integer field after the `Date` field:
ALTER TABLE crash05_15 ADD crash_year INT AFTER `Date`;
## this statement populates the `crash_year` field with the results of the YEAR function:
UPDATE crash05_15 SET crash_year = YEAR(`Date`);

circumstances_by_year:
#to solve the problem of multiple records per crash, count(Distinct crash_rpt_no)
SELECT circumstances, COUNT(DISTINCT crash_rpt_no)
FROM crash05_15
GROUP BY 1
ORDER BY 2 DESC
;
#to know the change over year, select crash_year as well, and group by both circumstance and year
SELECT circumstances, crash_year, COUNT(DISTINCT crash_rpt_no)
FROM crash05_15
GROUP BY 1, 2
ORDER BY 3 DESC

crashtyype_by_year
intersections_by_year
on_street_by_year
in_street_by_year

exported those into spreadsheets, did pivot table and found a lot of things dropping.

0323
called Loretta, Missouri State Highway Patrol:
1. to get complete records, should set circumstance to blank and "all".
2. per circumstance per record, no records for pedestrians without circumstance 
3. person involvement: pedestrian/driver present, means it's circumstance for pedestrian/driver present.
4. "Location", section 5 of the blank uniform crash report, has info about "?" miles before/after/at "?" intersecting street. How the officer choose the intersecting street is arbitrary. So, on_street and at_street is not completely precise and accurate.
5. "Driver" section, circumstance "Inattentative/distracted" has sub codes for communication device.
6. sent the csv with all fields from 2002 to 2014 

reorganized the folders. put new csv into tables/wholedataset

to filter out columbia data
inserted a new line in crash.csv, fieldname 1,2,3...49
municipality field 15, columbia code 0610
CTRL C, CTRL V, into google sheet, and a new csv
found data in field 3 really wierd, became something like 2.01E + 12
date and time field were wierd, too. date field 07:00.0 and time 00:00.0
went back to the original csv, fix the data type, made the first line (field names) text, the first two fields text.

questions:

how many records don't have lat and long:
2014 data: 1524 records in total, 32 records don't have lat and lon
how many pedestrian records, circumstances by pedestrians

0324
on my own mac downloaded 2014, 2012, 2010
crash.csv

2014 1524 records, 1492 have lat and lon
2012 1556 records, 1483 have lat and lon
2008 

filter by 15: 610, hide all fields, leaving 1, 24, 25. copy paste to lat.lon.xlxs
did so for 2014, 2012, 2008

downloaded all year data onto datalab2
desktop/wholedataset

2013 1562 crashes, filter columbia, leav 1,24,24, add to lat.lon
2011 1586 records, filter columbia, leave 1,24,24, add to lat.lon
2010 1848 records, filter columbia, leave 1,24,24, add to lat.lon
2009 2781 crashes,
2007 3158 crashes,
2006 3463 crashes,

Copied all into googlesheet columbia.lat.lon.06-14
Plotted in cartoDB, don’t know how to cluster analyze

Arcgis: no shapefile

Madi: remote connect to bombadil and use arcgis

Analyzed fatal circumstances on sequal pro localhost and datalib2
circumstance_year.sql:
SELECT crash_year, count(DISTINCT image_no) from crash05_15
WHERE severity = "fatal"
group by 1
;
SELECT circumstances, count(DISTINCT image_no) from crash05_15
WHERE severity = "fatal"
group by 1
ORDER BY 2 DESC
;
SELECT crash_year, circumstances, count(DISTINCT image_no) from crash05_15
WHERE severity = "fatal"
group by 1, 2

Copy paste result to fatal_circumstances_year.xlxs, pivot table
Three biggest circumstances: alcohol, speed_exceed_limit, none
All decreasing by year.
Flash drive went bad, saved onto mac desktop.

To do:

add field 10.44 leftTheScene, 10.38 DistractionCd

Is there a pattern, are some of them , a particular officer , geo-analysis

Create a new table for those don’t have lat and lon,

CREATE TABLE… AS
SELECT

Data cleaning, create a new field for intersection info formated as revofnizeable by geocoding system: street amdbersent street
bring the new table to geo code just for the new table
Do the geo coding

Look at where the points are, if there is concentrated area, if evenly distritubed across the city, don;t need to worry about including them

Extension of arcGis- Spatial analyst 
merge map of lat&lon, and map of those without lat&lon in one shapefile.

VIRGINIA AVE & HITT ST

For mapping, one table each year. Plot one year at a time

Get shapefile from boonecounty road’s file

April 1
Check whether circumstance as all or blank influence the data output
https://www.mshp.dps.missouri.gov/TR15Map/index.jsp













